{
  "name": "40083b8b-1e78-4de1-9d0d-30c3b6746f08",
  "displayName": "single available slot booking bug",
  "testCaseConversationTurns": [ {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "hi"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "event_meta_last": {
          "from_appointments": false
        },
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_valid": true,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "triggeredIntent": {
        "name": "Default Welcome Intent"
      },
      "currentPage": {
        "name": "Start Page",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "  Hello, Welcome to a private endocrinology clinic, I am your virtual assistant.\n" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "  How can i assist you today ?\n" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "  You can ask about your appointment, book a new appointment,  re-schedule your appointment or cancel appointment" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "book appointment"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "event_meta_last": {
          "from_appointments": false
        },
        "get_avail_specialist": true,
        "need_doctor_selection": true,
        "next_route": "new-booking",
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_valid": true,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "triggeredIntent": {
        "name": "appointment.new"
      },
      "currentPage": {
        "name": "Show-Specialist-Categories",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Sure, I need some information for a new appointment" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "We have the following specialists in our clinic " ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Pediatric Endocrinologist, Diabetologist, Urology, Surgeon, Internal Medicine Specialist, Endocrinologist, Nuclear Medicine Specialist, Gynaecologist, Surgery" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Please tell us which specialist you want to meet ?" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "You can always switch category by saying \"Change Category\"" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "endocrinologist"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "avail_doctor_count": 6,
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "doctor_avail_category": "Endocrinologist",
        "doctor_avail_list": "undefined Małgorzata Kiełczewska - 4\n--\nundefined Piotr Janczak - 5\n--\nundefined Katarzyna Krępuła - 6\n--\nundefined Beata Wikiera - 7\n--\nundefined Anna Otlewska - 8\n--\nundefined Irena Maruk - 9",
        "event_meta_last": {
          "from_appointments": false
        },
        "get_avail_specialist": true,
        "need_doctor_selection": true,
        "next_route": "new-booking",
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_valid": true,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "currentPage": {
        "name": "Choose-Doctor",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "One moment. Checking doctors for Endocrinologist" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "We have the following doctors for category Endocrinologist" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "undefined Małgorzata Kiełczewska - 4\n--\nundefined Piotr Janczak - 5\n--\nundefined Katarzyna Krępuła - 6\n--\nundefined Beata Wikiera - 7\n--\nundefined Anna Otlewska - 8\n--\nundefined Irena Maruk - 9" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Please tell us the doctor name or enter the corresponding number followed by Hash." ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "You can always  change  by saying \"Change Doctor\"" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "4"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "avail_default_slots_count": 1,
        "avail_doctor_count": 6,
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "doc_info": {
          "courtesy": "Mrs",
          "doctorId": "24535560215330817",
          "dtmf_number": "4",
          "firstname": "Małgorzata",
          "firstname_f": "Małgorzata",
          "fullName": "Małgorzata Kiełczewska",
          "fullName_f": "Małgorzata Kiełczewska",
          "lastname": "Kiełczewska",
          "lastname_f": "Kiełczewska",
          "row_id": "4",
          "specialists": [ "Internal Medicine Specialist", "Endocrinologist" ],
          "timeframe": "Monday 09:00 - 12:30; Tuesday 09:00 - 13:00; Wednesday 09:00 - 13:00 AND 15:00 - 18:30; Thursday 09:00 - 15:00; Friday 09:00 - 14:00",
          "title": "Doctor"
        },
        "doctor_avail_category": "Endocrinologist",
        "doctor_avail_list": "undefined Małgorzata Kiełczewska - 4\n--\nundefined Piotr Janczak - 5\n--\nundefined Katarzyna Krępuła - 6\n--\nundefined Beata Wikiera - 7\n--\nundefined Anna Otlewska - 8\n--\nundefined Irena Maruk - 9",
        "doctor_selected": "Małgorzata Kiełczewska",
        "event_meta_last": {
          "from_appointments": false
        },
        "get_avail_specialist": true,
        "is_slot_shown": false,
        "need_doctor_selection": true,
        "next_route": "new-booking",
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_valid": true,
        "slot_detail": {
          "next_dates": [ "2021-12-09", "2021-12-10", "2021-12-13", "2021-12-14", "2021-12-15", "2021-12-16", "2021-12-17", "2021-12-20", "2021-12-21", "2021-12-22", "2021-12-28", "2021-12-29", "2021-12-30", "2022-01-03", "2022-01-04", "2022-01-05", "2022-01-07", "2022-01-10", "2022-01-11", "2022-01-12", "2022-01-13", "2022-01-14", "2022-01-17", "2022-01-18", "2022-01-19", "2022-01-20", "2022-01-21", "2022-01-24", "2022-01-25", "2022-01-26", "2022-01-27", "2022-01-28" ],
          "next_dates_formatted": [ "9th December", "10th December", "13th December", "14th December", "15th December", "16th December", "17th December", "20th December", "21st December", "22nd December", "28th December", "29th December", "30th December", "3rd January", "4th January", "5th January", "7th January", "10th January", "11th January", "12th January", "13th January", "14th January", "17th January", "18th January", "19th January", "20th January", "21st January", "24th January", "25th January", "26th January", "27th January", "28th January" ],
          "slot_date": "2021-12-09",
          "slot_date_formatted": "9th December",
          "time_slots": [ "14:30" ],
          "time_slots_end": [ "15:00" ],
          "time_slots_f": [ "14:30" ]
        },
        "slot_refreshed": true,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "currentPage": {
        "name": "Show-Slots",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "You have selected Małgorzata Kiełczewska" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Doctor Małgorzata Kiełczewska is specialized  in\n\nInternal Medicine Specialist, Endocrinologist and usually available on Monday 09:00 - 12:30; Tuesday 09:00 - 13:00; Wednesday 09:00 - 13:00 AND 15:00 - 18:30; Thursday 09:00 - 15:00; Friday 09:00 - 14:00" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "The next immediate available slot with Doctor Małgorzata Kiełczewska  is " ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "On 9th December, we have 1 slots at, \n" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "14:30\n" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Do you want this slot ? \n" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "If you want slot for other dates please say \"next dates\"" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "To choose a different doctor, say \"change doctor\"" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "i want this slot"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "avail_default_slots_count": 1,
        "avail_doctor_count": 6,
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "doc_info": {
          "courtesy": "Mrs",
          "doctorId": "24535560215330817",
          "dtmf_number": "4",
          "firstname": "Małgorzata",
          "firstname_f": "Małgorzata",
          "fullName": "Małgorzata Kiełczewska",
          "fullName_f": "Małgorzata Kiełczewska",
          "lastname": "Kiełczewska",
          "lastname_f": "Kiełczewska",
          "row_id": "4",
          "specialists": [ "Internal Medicine Specialist", "Endocrinologist" ],
          "timeframe": "Monday 09:00 - 12:30; Tuesday 09:00 - 13:00; Wednesday 09:00 - 13:00 AND 15:00 - 18:30; Thursday 09:00 - 15:00; Friday 09:00 - 14:00",
          "title": "Doctor"
        },
        "doctor_avail_category": "Endocrinologist",
        "doctor_avail_list": "undefined Małgorzata Kiełczewska - 4\n--\nundefined Piotr Janczak - 5\n--\nundefined Katarzyna Krępuła - 6\n--\nundefined Beata Wikiera - 7\n--\nundefined Anna Otlewska - 8\n--\nundefined Irena Maruk - 9",
        "doctor_selected": "Małgorzata Kiełczewska",
        "event_meta_last": {
          "from_appointments": false
        },
        "get_avail_specialist": true,
        "is_slot_shown": false,
        "need_doctor_selection": true,
        "next_route": "new-booking",
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_valid": true,
        "slot_detail": {
          "next_dates": [ "2021-12-09", "2021-12-10", "2021-12-13", "2021-12-14", "2021-12-15", "2021-12-16", "2021-12-17", "2021-12-20", "2021-12-21", "2021-12-22", "2021-12-28", "2021-12-29", "2021-12-30", "2022-01-03", "2022-01-04", "2022-01-05", "2022-01-07", "2022-01-10", "2022-01-11", "2022-01-12", "2022-01-13", "2022-01-14", "2022-01-17", "2022-01-18", "2022-01-19", "2022-01-20", "2022-01-21", "2022-01-24", "2022-01-25", "2022-01-26", "2022-01-27", "2022-01-28" ],
          "next_dates_formatted": [ "9th December", "10th December", "13th December", "14th December", "15th December", "16th December", "17th December", "20th December", "21st December", "22nd December", "28th December", "29th December", "30th December", "3rd January", "4th January", "5th January", "7th January", "10th January", "11th January", "12th January", "13th January", "14th January", "17th January", "18th January", "19th January", "20th January", "21st January", "24th January", "25th January", "26th January", "27th January", "28th January" ],
          "slot_date": "2021-12-09",
          "slot_date_formatted": "9th December",
          "time_slots": [ "14:30" ],
          "time_slots_end": [ "15:00" ],
          "time_slots_f": [ "14:30" ]
        },
        "slot_refreshed": false,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "triggeredIntent": {
        "name": "doctor.slot.selection"
      },
      "currentPage": {
        "name": "Show-Slots",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "You have selected $intent.params.slot_time slot on 9th December" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Is this right ?" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "actual_slot_selected": "14:30",
        "avail_default_slots_count": 1,
        "avail_doctor_count": 6,
        "booking_slot_selected": true,
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "doc_info": {
          "courtesy": "Mrs",
          "doctorId": "24535560215330817",
          "dtmf_number": "4",
          "firstname": "Małgorzata",
          "firstname_f": "Małgorzata",
          "fullName": "Małgorzata Kiełczewska",
          "fullName_f": "Małgorzata Kiełczewska",
          "lastname": "Kiełczewska",
          "lastname_f": "Kiełczewska",
          "row_id": "4",
          "specialists": [ "Internal Medicine Specialist", "Endocrinologist" ],
          "timeframe": "Monday 09:00 - 12:30; Tuesday 09:00 - 13:00; Wednesday 09:00 - 13:00 AND 15:00 - 18:30; Thursday 09:00 - 15:00; Friday 09:00 - 14:00",
          "title": "Doctor"
        },
        "doctor_avail_category": "Endocrinologist",
        "doctor_avail_list": "undefined Małgorzata Kiełczewska - 4\n--\nundefined Piotr Janczak - 5\n--\nundefined Katarzyna Krępuła - 6\n--\nundefined Beata Wikiera - 7\n--\nundefined Anna Otlewska - 8\n--\nundefined Irena Maruk - 9",
        "doctor_selected": "Małgorzata Kiełczewska",
        "event_meta_last": {
          "from_appointments": false
        },
        "get_avail_specialist": true,
        "is_slot_shown": false,
        "need_doctor_selection": true,
        "next": "my-bookings",
        "next_route": "new-booking",
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_valid": true,
        "slot_detail": {
          "next_dates": [ "2021-12-09", "2021-12-10", "2021-12-13", "2021-12-14", "2021-12-15", "2021-12-16", "2021-12-17", "2021-12-20", "2021-12-21", "2021-12-22", "2021-12-28", "2021-12-29", "2021-12-30", "2022-01-03", "2022-01-04", "2022-01-05", "2022-01-07", "2022-01-10", "2022-01-11", "2022-01-12", "2022-01-13", "2022-01-14", "2022-01-17", "2022-01-18", "2022-01-19", "2022-01-20", "2022-01-21", "2022-01-24", "2022-01-25", "2022-01-26", "2022-01-27", "2022-01-28" ],
          "next_dates_formatted": [ "9th December", "10th December", "13th December", "14th December", "15th December", "16th December", "17th December", "20th December", "21st December", "22nd December", "28th December", "29th December", "30th December", "3rd January", "4th January", "5th January", "7th January", "10th January", "11th January", "12th January", "13th January", "14th January", "17th January", "18th January", "19th January", "20th January", "21st January", "24th January", "25th January", "26th January", "27th January", "28th January" ],
          "slot_date": "2021-12-09",
          "slot_date_formatted": "9th December",
          "time_slots": [ "14:30" ],
          "time_slots_end": [ "15:00" ],
          "time_slots_f": [ "14:30" ]
        },
        "slot_refreshed": false,
        "slot_selected": true,
        "slot_selected_valid": true,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Collect-Pesel-5",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "You'r Number is already registered with us. " ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Please provide your last 5 digit pesel number" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "02690"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "action_ended": true,
        "called_number": "Nirmal",
        "caller_id_voice": "9 2 8 3 1 8 1 2 2 8",
        "counters": {
          "invalid_pesel": 0,
          "next_apt": 0,
          "next_date": 0
        },
        "doc_info": {
          "courtesy": "Mrs",
          "doctorId": "24535560215330817",
          "dtmf_number": "4",
          "firstname": "Małgorzata",
          "firstname_f": "Małgorzata",
          "fullName": "Małgorzata Kiełczewska",
          "fullName_f": "Małgorzata Kiełczewska",
          "lastname": "Kiełczewska",
          "lastname_f": "Kiełczewska",
          "row_id": "4",
          "specialists": [ "Internal Medicine Specialist", "Endocrinologist" ],
          "timeframe": "Monday 09:00 - 12:30; Tuesday 09:00 - 13:00; Wednesday 09:00 - 13:00 AND 15:00 - 18:30; Thursday 09:00 - 15:00; Friday 09:00 - 14:00",
          "title": "Doctor"
        },
        "event_ended": true,
        "event_meta_last": {
          "booking_info": {
            "doc_info": {
              "courtesy": "Mrs",
              "doctorId": "24535560215330817",
              "dtmf_number": "4",
              "firstname": "Małgorzata",
              "firstname_f": "Małgorzata",
              "fullName": "Małgorzata Kiełczewska",
              "fullName_f": "Małgorzata Kiełczewska",
              "lastname": "Kiełczewska",
              "lastname_f": "Kiełczewska",
              "row_id": "4",
              "specialists": [ "Internal Medicine Specialist", "Endocrinologist" ],
              "timeframe": "Monday 09:00 - 12:30; Tuesday 09:00 - 13:00; Wednesday 09:00 - 13:00 AND 15:00 - 18:30; Thursday 09:00 - 15:00; Friday 09:00 - 14:00",
              "title": "Doctor"
            },
            "reference_id": "34818",
            "status": true
          }
        },
        "matchedUser": {
          "address": "Test Borowska",
          "brith_year": "1990",
          "city": "",
          "comments": null,
          "contact": "9283181228",
          "document": null,
          "email": "nirmalk.web@gmail.com",
          "gender": "K",
          "name": "Nirmal ",
          "nfz": null,
          "nip": "",
          "pcj_dom": "",
          "pcj_id": "26954",
          "pcj_kraj": "Polska",
          "pcj_mieszkanie": "",
          "pcj_okreslenie": "",
          "pcj_osobaupowazniona": "",
          "pcj_ulica": "Test Borowska",
          "pcj_wojewodztwo": "",
          "pesel": "6011702690",
          "phone": "9283181228",
          "surname": "Kumar",
          "teryt_simc_sym": "",
          "zip_code": "50-532"
        },
        "next": "my-bookings",
        "patient_id": "26954",
        "pesel": "6011702690",
        "pesel_last_5": "02690",
        "pesel_last_5_input": "02690",
        "pesel_last_5_verified": true,
        "pesel_valid": true,
        "pesel_verified": true,
        "slot_refreshed": false,
        "specialist_list": [ "Pediatric Endocrinologist", "Diabetologist", "Urology", "Surgeon", "Internal Medicine Specialist", "Endocrinologist", "Nuclear Medicine Specialist", "Gynaecologist", "Surgery" ],
        "user_exists": true,
        "valid_phone": true
      },
      "currentPage": {
        "name": "Anything-Else",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Your booking for Kiełczewska on 9th December , 14:30 has been successfully done, we have sent you the sms with confirmation of that visit. \n" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Your Booking Reference Number is : 34818" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Thank You" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Is there anything else we could help you ?" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  } ],
  "creationTime": {
    "seconds": 1638312637,
    "nanos": 797752000
  }
}
